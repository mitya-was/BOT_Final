# üöÄ Telegram Contract Bot 2.0 - Optimized

## ‚ú® **–ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–µ—Ä—Å—ñ—ó 2.0:**

### **üèóÔ∏è –ú–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:**
- –†–æ–∑–¥—ñ–ª–µ–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏ (`utils/`)
- –°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ (`handlers/`)
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- API –∫–ª—ñ—î–Ω—Ç –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º —Ç–∞ retry

### **‚ö° –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:**
- –ö–µ—à—É–≤–∞–Ω–Ω—è API –∑–∞–ø–∏—Ç—ñ–≤ (5 —Ö–≤)
- Retry –ª–æ–≥—ñ–∫–∞ –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –∫–æ–º–∞–Ω–¥

### **üéØ –ù–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏:**
```bash
/list [—Ñ—ñ–ª—å—Ç—Ä]     # –°–ø–∏—Å–æ–∫ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏
/search <—Ç–µ–∫—Å—Ç>    # –ü–æ—à—É–∫ –¥–æ–≥–æ–≤–æ—Ä—ñ–≤
/stats             # –®–≤–∏–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/export [—Ñ–æ—Ä–º–∞—Ç]   # –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
/health            # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–∏
/regen W-25-01     # –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è
/invoice W-25-01   # –®–≤–∏–¥–∫–∏–π —Ä–∞—Ö—É–Ω–æ–∫
/act W-25-01       # –®–≤–∏–¥–∫–∏–π –∞–∫—Ç
```

### **üîç –†–æ–∑—É–º–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏:**
```bash
/list –∞–∫—Ç–∏–≤–Ω—ñ      # –¢—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω—ñ
/list >50000       # –°—É–º–∞ –±—ñ–ª—å—à–µ 50–∫
/list –≥—Ä—É–¥–µ–Ω—å      # –ó–∞ –≥—Ä—É–¥–µ–Ω—å
/list –¢–û–í          # –ö–ª—ñ—î–Ω—Ç–∏ –∑ "–¢–û–í"
```

### **üìä –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö:**
- Excel (CSV)
- PDF (HTML)
- JSON
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

---

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É:**

```
telegram-bot/
‚îú‚îÄ‚îÄ bot-optimized.js           ‚Üê –ù–æ–≤–∏–π –æ—Å–Ω–æ–≤–Ω–∏–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ bot.js                     ‚Üê –°—Ç–∞—Ä–∏–π —Ñ–∞–π–ª (backup)
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ constants.js           ‚Üê –í—Å—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ logger.js              ‚Üê –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ apiClient.js           ‚Üê API –∫–ª—ñ—î–Ω—Ç –∑ –∫–µ—à–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ messageBuilder.js      ‚Üê –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ contractHandlers.js    ‚Üê –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–æ–≥–æ–≤–æ—Ä—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ commandHandlers.js     ‚Üê –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ logs/                      ‚Üê –õ–æ–≥–∏ –±–æ—Ç–∞ (—Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
‚îú‚îÄ‚îÄ package-optimized.json     ‚Üê –û–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îî‚îÄ‚îÄ README-OPTIMIZED.md        ‚Üê –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

---

## üöÄ **–ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó:**

### **1Ô∏è‚É£ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:**
```bash
cd telegram-bot
npm install
```

### **2Ô∏è‚É£ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è .env:**
```bash
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Google Services
GOOGLE_SCRIPT_URL=https://script.google.com/macros/s/.../exec
API_KEY=your_api_key
GOOGLE_FORM_URL=https://docs.google.com/forms/...
GOOGLE_DRIVE_FOLDER_ID=your_folder_id

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
LOG_LEVEL=info
NODE_ENV=production
```

### **3Ô∏è‚É£ –ó–∞–ø—É—Å–∫:**
```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start

# –†–æ–∑—Ä–æ–±–∫–∞
npm run dev

# –°—Ç–∞—Ä–∏–π –±–æ—Ç (backup)
npm run start:old
```

---

## üìä **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**

### **–ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤:**
```bash
# –ü–æ—Ç–æ—á–Ω—ñ –ª–æ–≥–∏
npm run logs

# –ê–±–æ –Ω–∞–ø—Ä—è–º—É
tail -f logs/bot-2024-12-15.log
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥—ñ–≤:**
```
[2024-12-15T10:30:45.123Z] [INFO] User action: view_contracts_list | {"chatId":156212174,"page":1}
[2024-12-15T10:30:46.456Z] [INFO] API call: contracts | {"endpoint":"contracts","duration":"234ms"}
[2024-12-15T10:30:47.789Z] [ERROR] Bot error: Connection timeout | {"error":"...","context":{...}}
```

### **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è:**
```bash
# –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É
/health

# –ß–µ—Ä–µ–∑ npm
npm run health
```

---

## üéØ **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–µ—Ä—Å—ñ–π:**

| –§—É–Ω–∫—Ü—ñ—è | v1.0 (bot.js) | v2.0 (bot-optimized.js) |
|---------|---------------|-------------------------|
| –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ | –ú–æ–Ω–æ–ª—ñ—Ç–Ω–∞ | –ú–æ–¥—É–ª—å–Ω–∞ |
| –ö–æ–º–∞–Ω–¥–∏ | 3 –æ—Å–Ω–æ–≤–Ω—ñ | 10+ –∫–æ–º–∞–Ω–¥ |
| –ü–æ—à—É–∫ | –ù–µ–º–∞—î | –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ |
| –§—ñ–ª—å—Ç—Ä–∏ | –ù–µ–º–∞—î | 4+ —Ç–∏–ø–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ |
| –ï–∫—Å–ø–æ—Ä—Ç | –ù–µ–º–∞—î | 3 —Ñ–æ—Ä–º–∞—Ç–∏ |
| –õ–æ–≥—É–≤–∞–Ω–Ω—è | Console.log | –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ |
| –ö–µ—à—É–≤–∞–Ω–Ω—è | –ù–µ–º–∞—î | 5 —Ö–≤ –∫–µ—à |
| Retry | –ù–µ–º–∞—î | 3 —Å–ø—Ä–æ–±–∏ |
| –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è | –û–±–º–µ–∂–µ–Ω–Ω—è 5 | –ü–æ–≤–Ω–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è |
| –ü–æ–º–∏–ª–∫–∏ | –ë–∞–∑–æ–≤–∞ | –†–æ–∑—à–∏—Ä–µ–Ω–∞ |

---

## üîß **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω—É:**

### **PM2 –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:**
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'was-contract-bot',
    script: 'bot-optimized.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      LOG_LEVEL: 'info'
    }
  }]
};
```

### **Docker:**
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
CMD ["npm", "start"]
```

---

## üêõ **–í—ñ–¥–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è:**

### **–ß–∞—Å—Ç—ñ –ø—Ä–æ–±–ª–µ–º–∏:**

1. **–ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î:**
   ```bash
   # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏
   tail -20 logs/bot-$(date +%Y-%m-%d).log
   
   # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ API
   /health
   ```

2. **–ü–æ–º–∏–ª–∫–∏ API:**
   ```bash
   # –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
   # (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)
   
   # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ URL —Ç–∞ –∫–ª—é—á
   echo $GOOGLE_SCRIPT_URL
   echo $API_KEY
   ```

3. **–ü–æ–≤—ñ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞:**
   ```bash
   # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–µ—à
   /health  # –ø–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à—É
   
   # –ó–±—ñ–ª—å—à–∏—Ç–∏ timeout –≤ utils/constants.js
   API_TIMEOUT: 45000
   ```

---

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**

### **üìà –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:**
- ‚ö° **–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:** 3x —à–≤–∏–¥—à–µ
- üîÑ **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å:** 5x –º–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫
- üíæ **–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ:** 30% –º–µ–Ω—à–µ
- üìä **–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:** 10x –±—ñ–ª—å—à–µ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π

### **üë• –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è UX:**
- üéØ –Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏
- üîç –ü–æ—Ç—É–∂–Ω–∏–π –ø–æ—à—É–∫
- üì± –ó—Ä—É—á–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
- ‚ö° –ú–∏—Ç—Ç—î–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

### **üõ†Ô∏è –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤:**
- üìù –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏
- üß© –ú–æ–¥—É–ª—å–Ω–∏–π –∫–æ–¥
- üîß –õ–µ–≥–∫–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∏

---

## üöÄ **–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**

1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–±–∏–¥–≤—ñ –≤–µ—Ä—Å—ñ—ó –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
2. **–ú—ñ–≥—Ä–∞—Ü—ñ—è:** –ü–æ—Å—Ç—É–ø–æ–≤–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏ –Ω–∞ v2.0
3. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:** –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
4. **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:** –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–∞ –±–∞–∑—ñ –º–æ–¥—É–ª—å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

**–ì–æ—Ç–æ–≤–æ –¥–æ production! üéâ**
